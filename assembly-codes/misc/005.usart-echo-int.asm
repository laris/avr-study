; EX 11-15 16
#INCLUDE "M328PDEF.INC"
; .equ	URXCaddr	= 0x0024	; USART Rx Complete
; .equ	UDREaddr	= 0x0026	; USART, Data Register Empty
; .equ	UTXCaddr	= 0x0028	; USART Tx Complete
.CSEG
    RJMP MAIN
.ORG URXCaddr
    RJMP URXC_INT_HANDLER
.ORG UDREaddr
    RJMP UDRE_INT_HANDLER
.ORG 40

MAIN:
    LDI R16, HIGH(RAMEND)
    OUT SPH, R16
    LDI R16, LOW(RAMEND)
    OUT SPL, R16

    LDI R16, (1<<RXEN0)|(1<<RXCIE0)|(1<<TXEN0)|(1<<UDRIE0)
    ;OUT UCSR0B, R16
    STS UCSR0B, R16
    LDI R16, (1<<UCSZ01)|(1<<UCSZ00)
    ;OUT UCSR0C, R16
    STS UCSR0C, R16
    LDI R16, 0x8
    ; OUT UBRR0L, R16
    STS UBRR0L, R16
    SEI

WAIT_HERE:
    RJMP WAIT_HERE

URXC_INT_HANDLER:
    ;IN R17,UDR0
    LDS R17,UDR0
    ;OUT UDR0, R17
    STS UDR0, R17
    RETI

UDRE_INT_HANDLER:
;    LDI R26, '>'
;    OUT UDR
    RETI
